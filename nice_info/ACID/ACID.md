Ниже приведён **конспект** по свойствам **ACID** (Atomicity, Consistency, Isolation, Durability), которые лежат в основе надёжных транзакций в реляционных СУБД (включая PostgreSQL).

---

## 1. Определение ACID

**ACID** — это набор свойств, которые определяют, как система управления базами данных (СУБД) обеспечивает корректность, согласованность и надёжность при выполнении транзакций.

- **A (Atomicity, Атомарность):**  
  Каждая транзакция либо выполняется целиком, либо не выполняется совсем. Если в процессе возникает ошибка, все изменения, сделанные в рамках транзакции, откатываются (rollback).

- **C (Consistency, Согласованность):**  
  Транзакция переводит базу данных из одного согласованного состояния в другое, соблюдая все правила целостности (ограничения уникальности, внешние ключи и т. д.). Если любое из условий целостности нарушается, транзакция не фиксируется.

- **I (Isolation, Изоляция):**  
  Одновременное выполнение нескольких транзакций не должно приводить к некорректным результатам. Каждая транзакция ведёт себя так, словно она выполняется в одиночку.  
  *(В PostgreSQL изоляция реализуется при помощи MVCC и выбором уровня изоляции: Read Committed, Repeatable Read, Serializable.)*

- **D (Durability, Долговечность):**  
  После фиксации (commit) результат транзакции должен сохраниться даже при сбоях системы. Для этого СУБД использует механизмы журналирования (WAL — Write-Ahead Logging в PostgreSQL), бэкапы и аварийное восстановление.

---

## 2. Атомарность (Atomicity)

### **Суть:**
- Транзакция — это единица работы, которая либо завершается полностью, либо откатывается.  
- «Частично выполненных» транзакций в итоге в базе не остаётся.

### **Пример:**
1. Перевод 1000 единиц с аккаунта A на аккаунт B:
   - Снять 1000 с аккаунта A.
   - Добавить 1000 на аккаунт B.
2. Если между «снять» и «добавить» произошёл сбой, вся операция отменяется, и оба аккаунта остаются в исходном состоянии.

---

## 3. Согласованность (Consistency)

### **Суть:**
- Транзакции должны соблюдать все **правила целостности** (например, не допускать отрицательного баланса, следовать уникальности ключей и т. п.).
- Если система находится в согласованном состоянии **до** транзакции, то и **после** транзакции она должна оставаться согласованной.

### **Пример:**
- Невозможно создать заказ без связанного в таблице товаров элемента, если внешний ключ это запрещает.
- Любая транзакция, нарушающая ограничения (constraints), будет отменена (rollback).

---

## 4. Изоляция (Isolation)

### **Суть (в общих чертах):**
- Одновременные транзакции не должны мешать друг другу так, чтобы итог нарушал корректность.
- Каждая транзакция ведёт себя так, будто она выполняется последовательно, без вмешательства других.

### **Механизмы:**
- **MVCC (Multiversion Concurrency Control):** обеспечивает, что транзакции читают «свои» версии данных, избегая ненужных блокировок на чтение.
- **Уровни изоляции** (Read Committed, Repeatable Read, Serializable и т. д.) контролируют, какие изменения видны «параллельным» транзакциям и когда.

*(Подробности об уровнях изоляции можно найти в отдельном конспекте.)*

---

## 5. Долговечность (Durability)

### **Суть:**
- После **commit** результаты транзакции сохраняются «навсегда», даже если сразу после фиксации произойдёт сбой (например, выключение сервера или сбой питания).

### **Как достигается:**
- **Write-Ahead Logging (WAL):**  
  - Каждое изменение записывается сначала в журнал (лог), а уже потом в основную часть базы.  
  - Если произошёл сбой, при перезапуске СУБД «догоняет» изменения, сверяясь с журналом.
- **Снапшоты (backups) и механизмы восстановления (recovery):**  
  - Регулярные бэкапы и режим «archiving» WAL-файлов позволяют откатиться или восстановить базу в консистентное состояние.

---

## 6. Взаимосвязь ACID и транзакций

- **Транзакция** — это **логическая единица работы**:
  1. Начинается (`BEGIN`).
  2. Выполняет операции (INSERT, UPDATE, DELETE, SELECT ...).
  3. Завершается:
     - **COMMIT** (фиксирует все изменения).
     - **ROLLBACK** (откатывает все изменения).

- **ACID** гарантирует**:
  1. **Atomicity**: либо все изменения, либо никакие.  
  2. **Consistency**: нет нарушений правил целостности.  
  3. **Isolation**: параллельные транзакции не мешают корректному результату.  
  4. **Durability**: зафиксированные изменения не теряются при сбое.

---

## 7. Краткий пример (PostgreSQL)

```sql
BEGIN;  -- Начинаем транзакцию

UPDATE accounts SET balance = balance - 500 WHERE id = 1;
UPDATE accounts SET balance = balance + 500 WHERE id = 2;

-- Если всё прошло успешно:
COMMIT;

-- Или если что-то пошло не так:
-- ROLLBACK;
```

1. **Атомарность**: Либо обе операции (списать, зачислить) завершатся, либо обе откатятся.  
2. **Согласованность**: Баланс всей системы не нарушается. Если один аккаунт уменьшен на 500, другой увеличен на 500.  
3. **Изоляция**: Параллельные транзакции не исказят результаты этой операции.  
4. **Долговечность**: После `COMMIT`, сбой не отменит перевод — при перезапуске СУБД данные будут уже записаны в журнал (WAL).

---

## 8. Заключение

- **ACID** — это фундамент надёжности для любой реляционной СУБД.  
- **Atomicity** и **Durability** обеспечиваются механизмом транзакционного логирования (WAL).  
- **Consistency** зависит от корректных ограничений (констрейнов) и общих правил в базе данных.  
- **Isolation** обеспечивается MVCC и выбором уровня изоляции транзакций.  

Поддержка ACID-свойств делает PostgreSQL и другие СУБД устойчивыми к сбоям и гарантирует целостность данных при параллельном выполнении операций.